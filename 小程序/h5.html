<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/element-ui@2.15.1/lib/theme-chalk/index.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css"
    />
  </head>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    #app {
      display: flex;
      flex-direction: column;
    }
    .avatar-uploader .el-upload {
      border: 1px dashed #d9d9d9;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .avatar-uploader .el-upload:hover {
      border-color: #409eff;
    }
    .avatar-uploader-icon {
      font-size: 28px;
      color: #8c939d;
      width: 100px;
      height: 100px;
      line-height: 100px;
      text-align: center;
    }
    .avatar {
      width: 100px;
      height: 100px;
      display: block;
    }
  </style>
  <body>
    <div id="app">
      <el-button @click="handleClick">Button</el-button>
      <van-button type="primary">主要按钮</van-button>
      <div>
        <van-uploader :after-read="afterRead" />
      </div>
      <br />

      <div>
        <span v-if="isShow">isShow</span>
        <span> {{ isShow }}</span>
        <van-button @click="postMessage">postMessage</van-button>
      </div>
      <div>
        <a id="desc" class="btn" onclick="jumpPay()">点击支付</a>
      </div>
      <div>{{ env }}</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>1</div>
      <div>
        <h3>图片上传</h3>
        <i class="el-icon-edit"></i>
        <el-upload
          class="avatar-uploader"
          action="https://jsonplaceholder.typicode.com/posts/"
          :show-file-list="false"
          :on-success="handleAvatarSuccess"
          :before-upload="beforeAvatarUpload"
        >
          <img v-if="imageUrl" :src="imageUrl" class="avatar" />
          <i v-else class="el-icon-plus avatar-uploader-icon"></i>
        </el-upload>
      </div>
      <div>
        <van-button @click="uploadPic">wxChooseImage</van-button>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-ui@2.15.1/lib/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>
    <script
      type="text/javascript"
      src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"
    ></script>
    <script>
      new Vue({
        el: '#app',
        data() {
          return {
            imageUrl: '',
            env: '123',
          }
        },
        computed: {
          isShow() {
            return this.ready()
          },
        },
        created() {
          wx.config({
            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId: 'wx88862397bb886228', // 必填，公众号的唯一标识
            timestamp: new Date().getTime(), // 必填，生成签名的时间戳
            // nonceStr: '', // 必填，生成签名的随机串
            signature: 'LIKLckvwlJT9cWIhEQTwfDwYEX-qKhb1otNLpJG0ZXIRBIPBHFAnrBXyXq4RknsXy1VtNGMYUtnDwzXCuCa4Yg',// 必填，签名
            jsApiList: [], // 必填，需要使用的JS接口列表
          })
          this.env = wx.miniProgram.getEnv()
        },
        mounted() {
          this.ready()
          console.log('wx', wx)
          wx.miniProgram.getEnv(function (res) {
            console.log(res.miniprogram)
          })
        },
        methods: {
          handleClick() {
            console.log('click')
          },
          afterRead(file) {
            // 此时可以自行将文件上传至服务器
            console.log(file)
          },
          ready() {
            return window.__wxjs_environment === 'miniprogram' // true
          },
          postMessage() {
            wx.miniProgram.postMessage({ data: 'foo' })
          },
          handleAvatarSuccess(res, file) {
            console.log('file: ', file)
            console.log('res: ', res)

            this.imageUrl = URL.createObjectURL(file.raw)
          },
          beforeAvatarUpload(file) {
            console.log('上传前file: ', file)
            const isJPG = file.type === 'image/jpeg'
            const isLt2M = file.size / 1024 / 1024 < 2

            if (!isJPG) {
              this.$message.error('上传头像图片只能是 JPG 格式!')
            }
            if (!isLt2M) {
              this.$message.error('上传头像图片大小不能超过 2MB!')
            }
            return isJPG && isLt2M
          },
          uploadPic() {
            wx.chooseImage({
              count: 1,
              sizeType: ['original', 'compressed'],
              sourceType: ['album', 'camera'],
              success(res) {
                // tempFilePath可以作为img标签的src属性显示图片
                const tempFilePaths = res.tempFilePaths
                console.log(res)
              },
            })
          },
          jumpPay() {
            let orderId = Date.now() //这里用当前时间戳做订单号（后面使用你自己真实的订单号）
            let money = 1 //订单总金额（单位分）
            let payData = { orderId: orderId, money: money }

            let payDataStr = JSON.stringify(payData) //因为要吧参数传递给小程序，所以这里需要转为字符串
            const url = `../wePay/wePay?payDataStr=${payDataStr}`
            wx.miniProgram.navigateTo({
              url: url,
            })
            // console.log("点击了去支付", url)
            console.log('点击了去支付')
          },
        },
      })
    </script>
  </body>
</html>
